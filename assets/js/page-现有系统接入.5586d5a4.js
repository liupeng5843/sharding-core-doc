(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{617:function(t,a,s){"use strict";s.r(a);var e=s(1),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"注意点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意点"}},[t._v("#")]),t._v(" 注意点")]),t._v(" "),s("p",[t._v("现有系统如果你是efcore的需要接入"),s("code",[t._v("ShardingCore")]),t._v("需要注意以下几点")]),t._v(" "),s("h3",{attrs:{id:"批处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批处理"}},[t._v("#")]),t._v(" 批处理")]),t._v(" "),s("p",[t._v("默认efcore下的批处理是基于当前DbContext的,如果现有系统接入并且替换了现有DbContext那么需要注意批处理的处理要兼容,ShardingCore默认是ShellDbContext带多个ExecutorDbContext，ShellDbContext会代理原先的查询。所以原先的批处理不能在DbContext上使用,具体参考 "),s("a",{attrs:{href:"/sharding-core-doc/adv/batch-operate"}},[t._v("批处理文档")]),t._v(" 不要问为什么,因为批处理不是efcore的接口")]),t._v(" "),s("h3",{attrs:{id:"追踪"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#追踪"}},[t._v("#")]),t._v(" 追踪")]),t._v(" "),s("p",[t._v("默认"),s("code",[t._v("ShardingCore")]),t._v("可以支持追踪哪怕是读写分离的情况下,包括select，add，update,remove,但是如果需要获取DbContext.ChangeTracker下的方法那么会无法获取目前有两种办法:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1.重写ChangeTracker可以参考源码的"),s("code",[t._v("ShardingChangeTracker")]),t._v(",通过替换"),s("code",[t._v("IChangeTrackerFactory")])])]),t._v(" "),s("li",[s("p",[t._v("2.通过"),s("code",[t._v("AbstractShardingDbContext")]),t._v("下的"),s("code",[t._v("IShardingDbContextExecutor")]),t._v("获取当前的DbContext然后可以获取到对应的DbContext进行处理")])]),t._v(" "),s("li",[s("p",[t._v("3.如果你需要在SaveChange的时候对一些变更信息进行记录或者审计那么可以通过重写带bool参数的SaveChange\n方法。")])])]),t._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SaveChanges")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bool")])]),t._v(" acceptAllChangesOnSuccess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IsExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//审计操作")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ChangeTracker.Entries().Where(xxxxx)")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            \n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("base")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SaveChanges")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("acceptAllChangesOnSuccess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);